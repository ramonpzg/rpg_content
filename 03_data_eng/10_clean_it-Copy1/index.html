
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Educational content on tech-related stuff.">
      
      
        <meta name="author" content="Ramon Perez">
      
      
        <link rel="canonical" href="https://ramonpzg.github.io/rpg_content/03_data_eng/10_clean_it-Copy1/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>10 clean it Copy1 - Architecting Technology</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#01-cleaning-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Architecting Technology" class="md-header__button md-logo" aria-label="Architecting Technology" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Architecting Technology
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              10 clean it Copy1
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ramonpzg/rpg_content" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RPG Content
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../01_setup/" class="md-tabs__link">
          
  
    
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index.md" class="md-tabs__link">
          
  
    
  
  Data Engineering

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../10_programming/" class="md-tabs__link">
          
  
    
  
  Programming

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../02_analytics/" class="md-tabs__link">
          
  
    
  
  Analytics

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../05_data_science/index.md" class="md-tabs__link">
        
  
    
  
  Data Science

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../07_mle/index.md" class="md-tabs__link">
        
  
    
  
  MLE

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../06_devops/index.md" class="md-tabs__link">
        
  
    
  
  DevOps

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../09_sw_dev/" class="md-tabs__link">
        
  
    
  
  WebDev

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../04_data_viz/" class="md-tabs__link">
          
  
    
  
  DataViz

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  GenAI

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../11_animotion/" class="md-tabs__link">
        
  
    
  
  Ani-Motion

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Architecting Technology" class="md-nav__button md-logo" aria-label="Architecting Technology" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Architecting Technology
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ramonpzg/rpg_content" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RPG Content
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../01_setup/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_setup/01_python_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_setup/02_anaconda_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anaconda Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_setup/03_git_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03_git_installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_setup/01_jupyter_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 Jupyter Intro
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Engineering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Data Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_terminal.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to Data Engineering
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../10_programming/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/02_types_vars.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 Types Vars
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/03_structures.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 Data Structures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/04_tools.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/05_control_flow.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 Control Flow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/06_terminal.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 The Terminal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/07_version_control.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 Version Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_programming/08_intermediate_python.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 Intermediate Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../02_analytics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Analytics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Analytics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/01_numerical_computing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Numerical Computing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/02_structured_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Structured Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/03_getting_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Getting Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/04_data_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Data Cleaning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/07_stats_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Statistics Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/10_describing_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Describing Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/11_eda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Exploratory Data Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/05_static_auctions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Case Study 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/06_interactive_airbnb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Case Study 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/08_data_prep_p1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Case Study 3 - Part 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_analytics/09_data_prep_p2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Case Study 3 - Part 2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_data_science/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Science
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../07_mle/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MLE
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06_devops/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_sw_dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebDev
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../04_data_viz/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    DataViz
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            DataViz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_data_viz/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_data_viz/01_static_dataviz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 Static Data Viz
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_data_viz/02_interactive_dataviz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 Interactive DataViz
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GenAI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../11_animotion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ani-Motion
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-cleaning-data" class="md-nav__link">
    <span class="md-ellipsis">
      01 Cleaning Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="01 Cleaning Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#outline-for-this-lesson" class="md-nav__link">
    <span class="md-ellipsis">
      Outline for this Lesson
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-structured-vs-unstructured-data" class="md-nav__link">
    <span class="md-ellipsis">
      1. Structured vs Unstructured Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-what-is-a-data-cleaning" class="md-nav__link">
    <span class="md-ellipsis">
      2. What is a Data Cleaning?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-what-is-a-dask-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      03 What is a dask dataframe?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-data-cleaning" class="md-nav__link">
    <span class="md-ellipsis">
      4. Data Cleaning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Data Cleaning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-reading-data-with-dask" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Reading Data with Dask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#let-the-cleaning-begin" class="md-nav__link">
    <span class="md-ellipsis">
      Let the Cleaning Begin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Let the Cleaning Begin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#42-dealing-with-duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Dealing with Duplicates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>10 clean it Copy1</h1>

<h2 id="01-cleaning-data">01 Cleaning Data<a class="headerlink" href="#01-cleaning-data" title="Permanent link">&para;</a></h2>
<blockquote>
<p><em>"There are only two forces in the world, <del>the sword</del> dirty data and <del>the spirit</del> clean data. In the long run the <del>sword</del> dirty data might (not) always be conquered by the <del>spirit</del> clean data."</em> ~ Napoleon CleanYourData</p>
</blockquote>
<p><img alt="Gathering Data" src="../../images/11.png" /></p>
<h3 id="outline-for-this-lesson">Outline for this Lesson<a class="headerlink" href="#outline-for-this-lesson" title="Permanent link">&para;</a></h3>
<ol>
<li>Structured vs Unstructured Data</li>
<li>What is a Data Cleaning?</li>
<li>What is a dask dataframe? üêº</li>
<li>Data Cleaning </li>
<li>Test Your Understanding</li>
</ol>
<h3 id="1-structured-vs-unstructured-data">1. Structured vs Unstructured Data<a class="headerlink" href="#1-structured-vs-unstructured-data" title="Permanent link">&para;</a></h3>
<h3 id="2-what-is-a-data-cleaning">2. What is a Data Cleaning?<a class="headerlink" href="#2-what-is-a-data-cleaning" title="Permanent link">&para;</a></h3>
<p>Wikipedia has a beatiful definition of data cleaning, which was in turned modified from a paper from Shaomin Wu titled, <em>"A Review on Coarse Warranty Data and Analysis"</em> (see citation below).</p>
<blockquote>
<p><em>"Data cleansing or data cleaning is the process of detecting and correcting (or removing) corrupt or inaccurate records from a record set, table, or database and refers to identifying incomplete, incorrect, inaccurate or irrelevant parts of the data and then replacing, modifying, or deleting the dirty or coarse data."</em> ~ Wikipedia &amp; Shaomin Wu</p>
</blockquote>
<p>When we first encounter messy data, we usually go through a non-exhaustive checklist and/or use some rules of thumbs to identify, tackle, and repeat, each mess from the messy pile of data we have. Some of the items in our checklist might be:</p>
<ul>
<li>Do we have column names?</li>
<li>Are the column names normalised? (e.g. lower case with no spaces and/or numbers in them)</li>
<li>Do we have dates? If so,<ul>
<li>how are these represented?</li>
<li>Do we have different formats in different rows? (e.g. 31-Oct-2020, October, 31st 2020, ...)</li>
<li>Do they have the time in them or is this in a separate column?</li>
</ul>
</li>
<li>Are there different data structures within an element of an observation? (e.g. do we have lists with lists in them inside the value of a row and column combinantion)</li>
<li>If we have numerical data points representing a monetary value, which denomination are these in?</li>
<li>How was the data generated?</li>
<li>Do we have any missing values? if so,<ul>
<li>Are they missing at random?</li>
<li>Are they missing by accident? (e.g. was it due to an error during the data collection process)</li>
<li>Are they intentionally empty? (e.g. think of a conditional question in a survey, if the participant answered yes to the previous question, use this one next, if not, skip 3 questions)</li>
</ul>
</li>
<li>Are there any outliers in our dataset? if so,<ul>
<li>Are these true outliers? (e.g. finding the salary of Jeff Bezos in a list with the income of all of the people from the state of Washington)</li>
<li>Are these mistakes? (e.g. finding negative prices for the price of bread)</li>
</ul>
</li>
<li>Are there any duplicate observations/samples in our dataset?</li>
</ul>
<p>All of this questions get tackled in a data format described by Hadley Wickham in a paper by the same name as the data format, called <em>"Tidy Data"</em>. In his paper, Hadley describes <em>Tidy Data</em> as:</p>
<blockquote>
<p><em>"Tidy datasets are easy to manipulate, model and visualise, and have a specific structure: each variable is a column, each observation is a row, and each type of observational unit is a table."</em> ~ Hadley Wickham</p>
</blockquote>
<p>While our datasets might not contain all of the issues described in Tidy Data that might come un in messy datasets, the strategies and concepts outlined in it will prove useful in many cases you might encounter throughout your career so I highly recommend that you read it at some point.</p>
<p>One last thing about data cleaning, it is not a one time thing during the data analytics cycle but quite the opposite, you might find yourself going back to the data cleaning process 2 or more times as your understanding of the data increases during the same project.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>
</span></code></pre></div></td></tr></table></div>
<h3 id="03-what-is-a-dask-dataframe">03 What is a dask dataframe?<a class="headerlink" href="#03-what-is-a-dask-dataframe" title="Permanent link">&para;</a></h3>
<p>In essence, a ton of lazy pandas!</p>
<p><img alt="many pandas" src="https://media.giphy.com/media/Ix6QPu53WlB6w/giphy.gif" /></p>
<p>Dask dataframes are lot of pandas dataframes that are lazily evaluated and throughout a session</p>
<h3 id="4-data-cleaning">4. Data Cleaning<a class="headerlink" href="#4-data-cleaning" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ProgressBar</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">dask</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="kn">import</span> <span class="nn">urllib</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="kn">from</span> <span class="nn">currency_converter</span> <span class="kn">import</span> <span class="n">CurrencyConverter</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="kn">from</span> <span class="nn">utilities</span> <span class="kn">import</span> <span class="n">check_or_add</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
<p>We will add our data directory to a variable to make sure we always have it at our disposal.</p>
<p><strong>Note:</strong> Make sure you change all of the forward slashes <code>/</code> into back slashes <code>\</code> if you are using Windows.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;../data&#39;</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's begin by checking out one of the files we downloaded from Belgium. We will first add the path to a variable and then use the <code>.read_csv()</code> method of dask dataframe. Most of dask dataframe's API mirrors in great detail the pandas API, which means that the <code>.read_csv()</code> we used in the last lesson will work almost identically in the example below using dask.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">bel_path</span> <span class="o">=</span> <span class="n">check_or_add</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;belgium_data&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="41-reading-data-with-dask">4.1 Reading Data with Dask<a class="headerlink" href="#41-reading-data-with-dask" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bel_path</span><span class="p">,</span> <span class="s1">&#39;csv_files&#39;</span><span class="p">,</span><span class="s1">&#39;belgium_*.csv&#39;</span><span class="p">))</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">ddf</span>
</span></code></pre></div></td></tr></table></div>
<p>Notice how the data was displayed very differently than with pandas, this is because dask does not read the data into memory until it needs it, instead,
- it creates different partitions (64MB/partition by default) of the data based on the amount of files we have and the size of each,
- it reads a small fraction of the data to
- infer the data type of each column and
- initialise a directed acyclic graph (DAG) where each computation we do on our dataframe will happen sequentially, and, were possible, in parallel.</p>
<blockquote>
<p>"A graph is formed by vertices and by edges connecting pairs of vertices, where the vertices can be any kind of object that is connected in pairs by edges. In the case of a directed graph, each edge has an orientation, from one vertex to another vertex. A path in a directed graph is a sequence of edges having the property that the ending vertex of each edge in the sequence is the same as the starting vertex of the next edge in the sequence; a path forms a cycle if the starting vertex of its first edge equals the ending vertex of its last edge. A directed acyclic graph is a directed graph that has no cycles." ~ <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">Wikipedia</a></p>
</blockquote>
<p>Example of a DAG:</p>
<p><img alt="dag_example" src="mydask.png" /></p>
<p>If you remember the <code>glob</code> module from the last notebook you might have noticed that we did the same to read in all of the files from Belgium. Dask gives us the same ability to retrieve multiple files, in multiple directories, recursively.</p>
<p>Without even examining the data we can already expect to have files with different columns depending on when the scraping took place and what kind of data was available at that time. Let's now have a look at the columns we have.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">ddf_columns</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bel_path</span><span class="p">,</span> <span class="s1">&#39;csv_files&#39;</span><span class="p">,</span><span class="s1">&#39;belgium_*.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">columns</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">ddf_columns</span><span class="p">),</span> <span class="n">ddf_columns</span>
</span></code></pre></div></td></tr></table></div>
<p>Wow! That's a of variables to play with and a lot of columns to go over. Let's now examine the first few rows of our file with the <code>.head()</code> method.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">ddf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>The reason we got an error while trying to read in the data was probably because don't have the same columns in all of the files, and/or because we don't have the same data types in each variable and dask doesn't know what to do or make of them. What we will do to work around this is to grab all of the columns in our files for each country, and select only the ones in common to all.</p>
<p>Let's create a function to get the columns in our datasets. We will use pandas again and then delayed the function using <code>dask.delayed</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="n">df_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="k">return</span> <span class="n">df_cols</span>
</span></code></pre></div></td></tr></table></div>
<p>We need all of our CSV files so we will grab them using the same glob method from before. Notice that we now have multiple <code>*</code> because we need to go through each country CSV folder.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">our_countries_data</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;csv_files&#39;</span><span class="p">,</span> <span class="s1">&#39;*.csv&#39;</span><span class="p">))</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">our_countries_data</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># let&#39;s have a look at how many files we have</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">our_countries_data</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>We will now iterate over each of our files, apply dask delayed to our function as we read the files, and then append the delayed objects to a list called <code>all_cols</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">all_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">our_countries_data</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">get_columns</span><span class="p">)(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="n">all_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">all_cols</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>Notice the delayed objects inside our list as well as the amount of time it took to create them. Since dask has not compute them yet, it too essentially no time collect the delayed instructions. Let's now apply the dask compute method to each delayed object in our list.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">]</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">results</span>
</span></code></pre></div></td></tr></table></div>
<p>Awesome! It only took a few seconds to grab the columns of each file so we ended up saving ourselves a lot of time. Imagine what it would have taken us to check the columns of every dataset 1 by 1?</p>
<p><img alt="Can't imagine" src="https://media.giphy.com/media/3ohjV3KahwmqwPwQLu/giphy.gif" /></p>
<h3 id="exercise-1">Exercise 1<a class="headerlink" href="#exercise-1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Get the length of each list of columns with a delayed object and add it to a list.</p>
</li>
<li>
<p>Calculate the average amount of columns from such list.</p>
</li>
</ol>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a>
</span></code></pre></div></td></tr></table></div>
<p>Answers below! Don't peak üëÄ</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">all_nums</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">our_countries_data</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">get_columns</span><span class="p">)(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="n">nums</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="nb">len</span><span class="p">)(</span><span class="n">cols</span><span class="p">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="n">all_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">num_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">all_nums</span><span class="p">]</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">num_results</span><span class="p">),</span> <span class="n">num_results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>The next step we will take is to gather all columns in common in our data sample. To do this, we will first import the reduce function from the standard library called functools. We will then create an anonymous lambda function that takes a set <code>x</code> and a set <code>y</code> and then grabs the intersecting columns starting at <code>x</code> and reducing the set by all <code>y</code>s. This way, we will make sure we grab only the columns in common within all of our files.</p>
<p>In case you come back to this notebook later on and you want to try using different countries, you could convert the output of the previous cells we have run into a pandas dataframe, and filter out the files without the specific variables you need or want.</p>
<p>Here is an example of how to check whether any of the files we will use does not have 106 columns.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;files&#39;</span><span class="p">:</span><span class="n">our_countries_data</span><span class="p">,</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a>              <span class="s1">&#39;columns&#39;</span><span class="p">:</span><span class="n">results</span><span class="p">,</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a>              <span class="s1">&#39;len&#39;</span><span class="p">:</span> <span class="n">num_results</span><span class="p">})</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;len&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">106</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<p>Since the reduce function is lazy by default, meaning, no computation will take place until we neet its output, we will wrap our reduce function in a list function so that it returns the output immediately.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">clean_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">results</span><span class="p">)))</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="n">clean_cols</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's check out how many columns we have in common for all of our files.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">clean_cols</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Time to help dask help us even further. Comma Separated Values tend to be quite messy, especially when they have a multiple columns with many quotations and commas. When this happens, one or more can easily find its way into the wrong spot.</p>
<p>To start things off we will read in the data with all columns as strings (or python objects). The reason behind this is that the way dask reads and interprets the data that goes into a dataframe, is by selecting a small sample of rows from all columns and inferring from them the data type that might be available in it. You can already imagine that with columns with many valid elements such date, unique identifiers for purchases, etc., some are bound to miss the mark and thus be evaluated incorrectly. In essence, we will read everything in as a string and work our way through each column to fix or get rid of any of the many missing values we might have.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># we will use a dictionary comprehension to assign the string type to each column in our clean_cols list</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">clean_cols</span><span class="p">}</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="n">dtypes</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*_data&#39;</span><span class="p">,</span> <span class="s1">&#39;csv_files&#39;</span><span class="p">,</span><span class="s1">&#39;*.csv&#39;</span><span class="p">),</span> <span class="c1"># glob through all of the files we have</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a>                  <span class="n">usecols</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="c1"># we will use all of the columns we gathered</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a>                  <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="c1"># with the string data type</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a>                  <span class="n">blocksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># and the blocksize to None so that dask does not split the partitions further</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="p">)</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="n">ddf</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="let-the-cleaning-begin">Let the Cleaning Begin<a class="headerlink" href="#let-the-cleaning-begin" title="Permanent link">&para;</a></h3>
<p>We now finally read in our data and can begin the cleaning process.</p>
<p><img alt="Gathering Data" src="../../images/12.png" /></p>
<p>Just like the function <code>compute</code> starts a computation for us, the <code>.head()</code> and <code>.tail()</code> of a dataframe will proceed to compute those operations on the fly. Hence, if we are dealing with massive amount of data, we might experience some lenghty wait times. Be cautious!</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">ddf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="42-dealing-with-duplicates">4.2 Dealing with Duplicates<a class="headerlink" href="#42-dealing-with-duplicates" title="Permanent link">&para;</a></h4>
<p>Since we are expecting to have quite a few duplicates from the get go due to the scraping tool periodically grabing whatever listings are available in a country at x time intervals, we will tackle this at the very beginning</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a>
</span></code></pre></div></td></tr></table></div>
<p>Let's now check out how even our partitions may or may not be. We will do so with using the <code>dask.dataframe</code> function called <code>map_partitions</code>. Remember that our dask dataframe is a combination of many lazy pandas, this means that maping a function to a partition will be the same as applying a function to a full pandas dataframe. Hence, our <code>len</code> function will give us the number of rows in each partition.</p>
<p>Note that since we are calling compute on our function, this might take a few seconds to be processed.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">ddf</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Since our partitions are way too uneven, we will repartition our dataset using the <code>dask.dataframe</code> method <code>.repartition()</code>. This method takes in several arguments and the most useful ones to use are <code>repartition</code>, which takes in a number of partition and tries to allocate rows accordingly, and <code>partition_size</code> which takes in a string with the size and type and then reallocates rows accordingly. The latter is a bit tricky because it triggers a computation, while the former follows the typical lazy evaluation. We will repartition as size to get a more even result right of the bat.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="n">ddf1</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="n">partition_size</span><span class="o">=</span><span class="s1">&#39;150MB&#39;</span><span class="p">)</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="n">ddf1</span><span class="o">.</span><span class="n">npartitions</span>
</span></code></pre></div></td></tr></table></div>
<p>Notice that because we are now creating a DAG, we will be assigning our dataframes computations each to a new variable.</p>
<p>For example sake, let's check one more time the length of each partition now that we have reallocated the rows to a more evenlt-distributed way.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">ddf1</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Nice! Our partitions look way more even now.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span>
<span class="normal"><a href="#__codelineno-29-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="c1"># Get the raw count of missing values in all columns</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="n">missing_values</span> <span class="o">=</span> <span class="n">ddf1</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="c1"># Divide it by the total size of the dataset and multiply by 100 to get the % of the total</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="n">missing_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">missing_values</span> <span class="o">/</span> <span class="n">ddf1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="n">missing_pct</span>
</span></code></pre></div></td></tr></table></div>
<p>We will start by selecting a few thresholds.</p>
<ul>
<li>For columns that have less than 5% of their values missing, we will drop these rows.</li>
<li>For columns that have an amount of missing values between 5% exclusive, and 50% exclusive, we will see how we can fix these.</li>
<li>For columns that have an amount of missing values greater than or equal to 50%, we will drop these columns.</li>
</ul>
<p>Notice that our missing_count_pct is a pandas series and the column names of our dataframe represent the index of our series. This means that we can create a mask with a percentage condition, and use the <code>.index</code> attribute from pandas to select the names of the columns.</p>
<p>Note that since our we already computed this operation, our pandas series of missing percentages lives in memory. Hence, we do not need to call compute again.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">rows_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_pct</span><span class="p">[(</span><span class="n">missing_pct</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">missing_pct</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">rows_to_drop</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We will be dropping rows from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_to_drop</span><span class="p">)</span><span class="si">}</span><span class="s1"> columns that have less than 5% of observations missing. Wow!&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">ddf2</span> <span class="o">=</span> <span class="n">ddf1</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">rows_to_drop</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="exercise-2">Exercise 2<a class="headerlink" href="#exercise-2" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create a list of the columns to drop. These columns should have more than or equal to 50% of missing values. Name this variable <code>cols_to_drop</code>.</p>
</li>
<li>
<p>Create a list of columns to fix. These columns should have between 5% and 50% of missing values (exclusive of these two numbers). Name this new variable <code>fix_these_columns</code>.</p>
</li>
</ol>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a>
</span></code></pre></div></td></tr></table></div>
<p>Answers below! Don't cheat üëÄ</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="n">cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_pct</span><span class="p">[(</span><span class="n">missing_pct</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">cols_to_drop</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">fix_these_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_pct</span><span class="p">[(</span><span class="n">missing_pct</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">missing_pct</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="n">fix_these_columns</span>
</span></code></pre></div></td></tr></table></div>
<p>Now, let's go ahead and remove the columns we would like to drop because they have more than half of their values missing.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">ddf3</span> <span class="o">=</span> <span class="n">ddf2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>We can visualize what we have done so far with our many dataframes by calling the visualize method on <code>ddf3</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">ddf3</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dropping_cols.png&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>By passing the <code>fix_these_columns</code> list to our dataframe and calling the <code>.head()</code> method we can evaluate the data types available in each of the columns that are left to clean.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">ddf3</span><span class="p">[</span><span class="n">fix_these_columns</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Since we don't know the real reason for the missing values in the non-numerical colums, (for example, transit might be empty because the location is geniuinly away from any trafic whatsoever or the house might have no strict rules at all ü§∑üèª) we will select these columns manually, add them to a list, and fill in any missing values using the word <code>"Unknown"</code>. We will create this mapping of column names with the word <code>"Unknown"</code> with the help of a dictionary comprehension again and pass it to the dask dataframe method called <code>.fillna()</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="n">non_numerical_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;neighborhood_overview&#39;</span><span class="p">,</span> <span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;transit&#39;</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">,</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a>                      <span class="s1">&#39;interaction&#39;</span><span class="p">,</span> <span class="s1">&#39;house_rules&#39;</span><span class="p">,</span> <span class="s1">&#39;host_about&#39;</span><span class="p">,</span> <span class="s1">&#39;host_response_time&#39;</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="n">unknown_condition</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span><span class="s1">&#39;Unknown&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_numerical_vars</span><span class="p">}</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">unknown_condition</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">ddf4</span> <span class="o">=</span> <span class="n">ddf3</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">unknown_condition</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's get the rest of the variables we need to fix by taking the set difference between the <code>non_numerical_vars</code> list and the <code>fix_these_columns</code> list.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">set_of_cols_left</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fix_these_columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">non_numerical_vars</span><span class="p">))</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">set_of_cols_left</span>
</span></code></pre></div></td></tr></table></div>
<p>Convert all dates to datetime</p>
<p>If an observation has comments but no first in last out date range, use the day they became a host as a proxy and the date that observation was last scraped</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="n">time_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;review_scores_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()))</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="n">temp</span> <span class="o">=</span> <span class="n">ddf10</span><span class="p">[</span><span class="n">time_mask</span><span class="p">]</span><span class="c1">#, [&#39;host_since&#39;, &#39;last_scraped&#39;]].head()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="p">(</span><span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddf10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="n">ddf10</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>To finish up with reviews, we will fill in the first and last review vars with the date in the host_since variaable</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">ddf14</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">,</span> <span class="s1">&#39;host_since&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span>
<span class="normal"><a href="#__codelineno-49-5">5</a></span>
<span class="normal"><a href="#__codelineno-49-6">6</a></span>
<span class="normal"><a href="#__codelineno-49-7">7</a></span>
<span class="normal"><a href="#__codelineno-49-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="n">first_review_condition</span> <span class="o">=</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="n">last_review_condition</span> <span class="o">=</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="n">first_review</span> <span class="o">=</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">first_review_condition</span><span class="p">,</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;host_since&#39;</span><span class="p">])</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="n">last_review</span> <span class="o">=</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">last_review_condition</span><span class="p">,</span> <span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;host_since&#39;</span><span class="p">])</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="n">ddf15</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf14</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;first_review&#39;</span><span class="p">,</span> <span class="s1">&#39;last_review&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8"></a>              <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">first_review</span><span class="o">=</span><span class="n">first_review</span><span class="p">,</span> <span class="n">last_review</span><span class="o">=</span><span class="n">last_review</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">ddf15</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf14</span><span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">,</span> <span class="s1">&#39;last_review&#39;</span><span class="p">,</span> <span class="s1">&#39;host_since&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="n">set_of_cols_left</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;first_review&#39;</span><span class="p">)</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="n">set_of_cols_left</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;last_review&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>We will take out the dates varaibles for now as we will have to deal with these in a different manner later on.</p>
<p>Let's examine the values of what we have left.</p>
<p><strong>Note:</strong> Remember, that it is not advisable to call <code>.head()</code> or <code>.tail()</code> too often because depending on the size of the data, it could take quite some time for the operation to be processed. We are using it here for illustrative purposes only.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">ddf4</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">set_of_cols_left</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Sometimes we do have to take care of things manually so we will start by dealing with all of the columns that have a currency sign in them regardless if they have missing values or not. Because we only want the digits and the periods, we will import <code>digits</code> from the string module in Python, and add to it the <code>.</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">digits</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="n">digits</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span>
</span></code></pre></div></td></tr></table></div>
<p>For our cleaning currency function, we will pass in a value from a column, check whether it is a string or something else, and strip out anything that is not a number or a <code>.</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span>
<span class="normal"><a href="#__codelineno-54-6">6</a></span>
<span class="normal"><a href="#__codelineno-54-7">7</a></span>
<span class="normal"><a href="#__codelineno-54-8">8</a></span>
<span class="normal"><a href="#__codelineno-54-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2"></a>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="k">def</span> <span class="nf">remove_puncs</span><span class="p">(</span><span class="n">string_piece</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4"></a>    <span class="k">if</span> <span class="n">string_piece</span><span class="p">:</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5"></a>        <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">string_piece</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6"></a>        <span class="n">clean_str2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">num3</span> <span class="k">for</span> <span class="n">num3</span> <span class="ow">in</span> <span class="n">string</span> <span class="k">if</span> <span class="n">num3</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">])</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7"></a>        <span class="k">return</span> <span class="n">clean_str2</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></code></pre></div></td></tr></table></div>
<p>Since we should always test our functions, let's make sure it does return numbers the way we need them.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;„Äí1690072&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">7.0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5%&#39;</span><span class="p">,</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;$39.0&#39;</span><span class="p">,</span> <span class="s1">&#39;$23.56&#39;</span><span class="p">]</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="n">test_examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">remove_puncs</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">]</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="n">test_examples</span>
</span></code></pre></div></td></tr></table></div>
<p>We can also check that the values can be converted to float without any issues.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_examples</span><span class="p">)):</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<p>Using the <code>deafaultdict</code> method from the collections module, we will iterate over our numerical columns while cleaning the numbers up a bit.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span>
<span class="normal"><a href="#__codelineno-57-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="n">strip_type_col</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">set_of_cols_left</span><span class="p">:</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a>    <span class="n">strip_type_col</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddf4</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">remove_puncs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;coerce&#39;</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Because we created a dictionary with the column names as the keys and dask series as the values, we can call the keys method on the dictionary while wrapping it inside a list whitin the <code>.drop()</code> method and then assign the dictionary back into the the dataframe.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="n">ddf5</span> <span class="o">=</span> <span class="n">ddf4</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">strip_type_col</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="n">ddf6</span> <span class="o">=</span> <span class="n">ddf5</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">strip_type_col</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Notice the <code>**</code> in the operation above. This is one of the many convenient features Python has as a programming language. The double star allows us to unpack key-value pairs from a dictionary and saves us from having to extract extract every pair manually or in a loop. You will often see operations like these ones being referred to as <code>**kwargs</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="n">ddf6</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="n">ddf6</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">strip_type_col</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span><span class="o">.</span><span class="n">dtypes</span>
</span></code></pre></div></td></tr></table></div>
<p>We successfully implemented our method and can see that not only the new columns have been added to the end of our dataframe but also that the data type for these columns has changed to <code>float32</code>, which is a smaller in size data type than the Python default <code>float64</code>.</p>
<p>As you can see, our DAG is becoming bigger and bigger with every operation we make. Because of this, our session might become a bit sluggish and time consuming as we progress and try to compute calculations since dask will have to do all of the steps from reading the data to our latest operation. To avoid this, we can save part of the our operations' state with the <code>.persist()</code> method of dask. That way, when we need to compute something on the fly, dask won't have to start from scratch.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">():</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a>    <span class="n">ddf7</span> <span class="o">=</span> <span class="n">ddf6</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>No that we went down the path of assigning the proper data type to some of our variables, let's go ahead and do it for all of them. Here are two lists separating the floats from the integer columns. We will use a similar approach to recode them.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span>
<span class="normal"><a href="#__codelineno-63-4">4</a></span>
<span class="normal"><a href="#__codelineno-63-5">5</a></span>
<span class="normal"><a href="#__codelineno-63-6">6</a></span>
<span class="normal"><a href="#__codelineno-63-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">float_numericals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> 
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2"></a>                    <span class="s1">&#39;extra_people&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum_nights_avg_ntm&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum_nights_avg_ntm&#39;</span><span class="p">]</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="n">int_numericals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accommodates&#39;</span><span class="p">,</span> <span class="s1">&#39;guests_included&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum_minimum_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum_minimum_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum_maximum_nights&#39;</span><span class="p">,</span> 
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5"></a>                  <span class="s1">&#39;maximum_maximum_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;availability_30&#39;</span><span class="p">,</span> <span class="s1">&#39;availability_60&#39;</span><span class="p">,</span> <span class="s1">&#39;availability_90&#39;</span><span class="p">,</span> <span class="s1">&#39;availability_365&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">,</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6"></a>                  <span class="s1">&#39;number_of_reviews_ltm&#39;</span><span class="p">,</span> <span class="s1">&#39;calculated_host_listings_count&#39;</span><span class="p">,</span> <span class="s1">&#39;calculated_host_listings_count_entire_homes&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;beds&#39;</span><span class="p">,</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7"></a>                  <span class="s1">&#39;calculated_host_listings_count_private_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;calculated_host_listings_count_shared_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;host_listings_count&#39;</span><span class="p">,</span> <span class="s1">&#39;host_total_listings_count&#39;</span><span class="p">,</span> <span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>We will create another default dictionary with a <code>dask.dataframe.Series</code> as its default data type, and call it <code>dict_numerical_cols</code>. We will then iterate over the columns from both lists of ints and float, apply our <code>remove_puncs()</code> func using the <code>.apply()</code> method, and then change the data types respectively.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span>
<span class="normal"><a href="#__codelineno-64-6">6</a></span>
<span class="normal"><a href="#__codelineno-64-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="n">dict_numerical_cols</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">float_numericals</span><span class="p">:</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a>    <span class="n">dict_numerical_cols</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddf7</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">remove_puncs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;float32&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">int_numericals</span><span class="p">:</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7"></a>    <span class="n">dict_numerical_cols</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddf7</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">remove_puncs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;float32&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># here are all of the columns we just changed the data type of</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="n">dict_numerical_cols</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1"># here is the amount of columns we converted</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">dict_numerical_cols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
<p>We will now drop the the old columns from our dataframe and assign the new ones back in.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="n">ddf8</span> <span class="o">=</span> <span class="n">ddf7</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_numerical_cols</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="n">ddf9</span> <span class="o">=</span> <span class="n">ddf8</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">dict_numerical_cols</span><span class="p">)</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="n">ddf9</span><span class="o">.</span><span class="n">dtypes</span> <span class="c1"># notice how our data types have now change to ints and floats</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span>
<span class="normal"><a href="#__codelineno-68-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2"></a>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="n">missing_values</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="n">whats_left_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">missing_values</span> <span class="o">/</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="n">whats_left_pct</span>
</span></code></pre></div></td></tr></table></div>
<p>Now that we have made some great progress fixing some of the inconsistencies in our data, let' finish dealing with the missing values. Here is the list of missing values we still need to fix, minus the <code>first_review</code> and <code>last_review</code> variables.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="n">set_of_cols_left</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="n">ddf9</span><span class="p">[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">ddf9</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span>
<span class="normal"><a href="#__codelineno-72-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2"></a>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="n">host_frequency</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;host_id&#39;</span><span class="p">)[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="n">host_frequency</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="n">ddf9</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf9</span><span class="p">[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;10026319&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="n">id_frequency</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">id_frequency</span><span class="p">),</span> <span class="n">id_frequency</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="n">id_frequency</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="n">ddf9</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf9</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;10015096&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="n">q_data</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf9</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;10004342&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="n">q_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">356</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">q_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">373</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span>
<span class="normal"><a href="#__codelineno-79-4">4</a></span>
<span class="normal"><a href="#__codelineno-79-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="n">numerical_left_to_fill</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;review_scores_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_cleanliness&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_rating&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">,</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2"></a>                          <span class="s1">&#39;host_response_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_communication&#39;</span><span class="p">,</span> <span class="s1">&#39;reviews_per_month&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_location&#39;</span><span class="p">,</span> 
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3"></a>                          <span class="s1">&#39;security_deposit&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_value&#39;</span><span class="p">,</span> <span class="s1">&#39;review_scores_checkin&#39;</span><span class="p">]</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4"></a>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="n">dates_left</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_review&#39;</span><span class="p">,</span> <span class="s1">&#39;last_review&#39;</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2"></a>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="n">ddf9</span><span class="p">[</span><span class="n">numerical_left_to_fill</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Before we deal with these vars, we want to first figure out how to get rid of duplicates</p>
<h3 id="exercise-3">Exercise 3<a class="headerlink" href="#exercise-3" title="Permanent link">&para;</a></h3>
<ol>
<li>What do you think will happen once we get rid of duplicates, will we have more missing values as a percentage of the total or less?</li>
</ol>
<p><strong>Hint:</strong> This is a trick question!</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="n">dups</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">duplicated</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="n">dups</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span>
<span class="normal"><a href="#__codelineno-83-2">2</a></span>
<span class="normal"><a href="#__codelineno-83-3">3</a></span>
<span class="normal"><a href="#__codelineno-83-4">4</a></span>
<span class="normal"><a href="#__codelineno-83-5">5</a></span>
<span class="normal"><a href="#__codelineno-83-6">6</a></span>
<span class="normal"><a href="#__codelineno-83-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="k">def</span> <span class="nf">get_rid_of_duplicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">last_scraped_col</span><span class="p">,</span> <span class="n">id_col</span><span class="p">):</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5"></a>    <span class="n">data1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">last_scraped_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6"></a>    <span class="n">data2</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">id_col</span><span class="p">)</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7"></a>    <span class="k">return</span> <span class="n">data2</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="n">ddf10</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="n">get_rid_of_duplicates</span><span class="p">,</span> <span class="n">last_scraped_col</span><span class="o">=</span><span class="s1">&#39;last_scraped&#39;</span><span class="p">,</span> <span class="n">id_col</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">ddf9</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">ddf10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span>
<span class="normal"><a href="#__codelineno-87-3">3</a></span>
<span class="normal"><a href="#__codelineno-87-4">4</a></span>
<span class="normal"><a href="#__codelineno-87-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2"></a>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="c1"># let&#39;s get a statistic or two from the length of our partitions</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4"></a><span class="n">parts_lenght</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5"></a><span class="n">parts_lenght</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="n">parts_lenght</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">parts_lenght</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="n">ddf10</span> <span class="o">=</span> <span class="n">ddf9</span><span class="o">.</span><span class="n">map_overlap</span><span class="p">(</span><span class="n">get_rid_of_duplicates</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">last_scraped_col</span><span class="o">=</span><span class="s1">&#39;last_scraped&#39;</span><span class="p">,</span> <span class="n">id_col</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="c1"># round 2 of ddf10p2 with 2000 up and down</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">ddf10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="n">id_frequency2</span> <span class="o">=</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;host_id&#39;</span><span class="p">)[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="n">id_frequency2</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="n">ddf9</span><span class="p">[</span><span class="n">ddf9</span><span class="p">[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;159006893&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="n">mask_id</span> <span class="o">=</span> <span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;host_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;159006893&#39;</span><span class="p">])</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="n">ddf10</span><span class="p">[</span><span class="n">mask_id</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="n">im</span> <span class="o">=</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_id</span><span class="p">,</span> <span class="s1">&#39;picture_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="n">im</span><span class="p">[</span><span class="mi">912</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span>
<span class="normal"><a href="#__codelineno-95-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="n">an_image</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf</span><span class="p">[</span><span class="s1">&#39;picture_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="s1">&#39;picture_url&#39;</span><span class="p">]</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="n">a</span> <span class="o">=</span> <span class="n">an_image</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="n">a</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span>
<span class="normal"><a href="#__codelineno-96-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="k">def</span> <span class="nf">image_show</span><span class="p">(</span><span class="n">image_url</span><span class="p">):</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2"></a>    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="n">image_show</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="n">image_show</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">857</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="n">image_show</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">912</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1">1</a></span>
<span class="normal"><a href="#__codelineno-100-2">2</a></span>
<span class="normal"><a href="#__codelineno-100-3">3</a></span>
<span class="normal"><a href="#__codelineno-100-4">4</a></span>
<span class="normal"><a href="#__codelineno-100-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2"></a>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="n">missing_values</span> <span class="o">=</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="n">whats_left_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">missing_values</span> <span class="o">/</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5"></a><span class="n">whats_left_pct</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's start with security deposit . We will assume that if a value is missing, the listing doesn't requie a deposit</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="n">sec_dep_des</span> <span class="o">=</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)[</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1">#aggregate([&#39;min&#39;, &#39;median&#39;, &#39;mean&#39;, &#39;max&#39;, &#39;count&#39;])</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="n">sec_dep_des</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span>
<span class="normal"><a href="#__codelineno-103-3">3</a></span>
<span class="normal"><a href="#__codelineno-103-4">4</a></span>
<span class="normal"><a href="#__codelineno-103-5">5</a></span>
<span class="normal"><a href="#__codelineno-103-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="n">deposit_mask</span> <span class="o">=</span> <span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2"></a>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="n">security_deposit</span> <span class="o">=</span> <span class="n">ddf10</span><span class="p">[</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">deposit_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4"></a>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="n">ddf11</span> <span class="o">=</span> <span class="n">ddf10</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="n">ddf12</span> <span class="o">=</span> <span class="n">ddf11</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">security_deposit</span><span class="o">=</span><span class="n">security_deposit</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span>
<span class="normal"><a href="#__codelineno-105-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="n">whats_left_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">whats_left_pct</span><span class="p">[</span><span class="n">whats_left_pct</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="n">whats_left_cols</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="n">whats_left_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;security_deposit&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="n">whats_left_cols</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="n">ddf12</span><span class="p">[</span><span class="n">whats_left_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's look at the distribution of the variables we have left</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="n">ddf12</span><span class="p">[</span><span class="n">whats_left_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's now talk about reviews</p>
<p>These seem to be standardize across Airbnb so we can evaluate them in combination</p>
<p><img alt="reviews" src="../../images/reviews.png" /></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="n">ddf12</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;reviews_per_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span>
<span class="normal"><a href="#__codelineno-111-2">2</a></span>
<span class="normal"><a href="#__codelineno-111-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="n">reviews_to_check</span> <span class="o">=</span> <span class="p">((</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_checkin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;reviews_per_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2"></a>                    <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_cleanliness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> 
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3"></a>                    <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf12</span><span class="p">[</span><span class="s1">&#39;review_scores_communication&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()))</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="n">ddf12</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reviews_to_check</span><span class="p">,</span> <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Awesome, we just comfirmed that indeed, these missing values are not missing because of mistakes or issues, but simply because these listings have not received a single review. This means we can go ahead and fill them up with 0s.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span>
<span class="normal"><a href="#__codelineno-113-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="n">reviews_cols_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">review</span> <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">whats_left_cols</span> <span class="k">if</span> <span class="s1">&#39;review_&#39;</span> <span class="ow">in</span> <span class="n">review</span> <span class="ow">or</span> <span class="s1">&#39;reviews_&#39;</span> <span class="ow">in</span> <span class="n">review</span><span class="p">]</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="n">reviews_cols_list</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span>
<span class="normal"><a href="#__codelineno-114-2">2</a></span>
<span class="normal"><a href="#__codelineno-114-3">3</a></span>
<span class="normal"><a href="#__codelineno-114-4">4</a></span>
<span class="normal"><a href="#__codelineno-114-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="n">clean_reviews</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2"></a>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="k">for</span> <span class="n">review_col</span> <span class="ow">in</span> <span class="n">reviews_cols_list</span><span class="p">:</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4"></a>    <span class="n">condition</span> <span class="o">=</span> <span class="n">ddf12</span><span class="p">[</span><span class="n">review_col</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5"></a>    <span class="n">clean_reviews</span><span class="p">[</span><span class="n">review_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddf12</span><span class="p">[</span><span class="n">review_col</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1">1</a></span>
<span class="normal"><a href="#__codelineno-115-2">2</a></span>
<span class="normal"><a href="#__codelineno-115-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="n">ddf13</span> <span class="o">=</span> <span class="n">ddf12</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clean_reviews</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="n">ddf14</span> <span class="o">=</span> <span class="n">ddf13</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">clean_reviews</span><span class="p">)</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="n">ddf14</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2"></a>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3"></a><span class="n">ddf15</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="n">ddf16</span> <span class="o">=</span> <span class="n">ddf15</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="n">partition_size</span><span class="o">=</span><span class="s1">&#39;160MB&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span>
<span class="normal"><a href="#__codelineno-118-2">2</a></span>
<span class="normal"><a href="#__codelineno-118-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2"></a>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="n">ddf16</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span>
<span class="normal"><a href="#__codelineno-119-4">4</a></span>
<span class="normal"><a href="#__codelineno-119-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2"></a>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="n">missing_values</span> <span class="o">=</span> <span class="n">ddf16</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4"></a><span class="n">whats_left_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">missing_values</span> <span class="o">/</span> <span class="n">ddf16</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> 
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5"></a><span class="n">whats_left_pct</span>
</span></code></pre></div></td></tr></table></div>
<p>You would think that people depend heavily on their reputation for this business, hence reviews must be closely tied to <code>host_response_rate</code>, or so we will think for this case.</p>
<p>We will fill in the missing values with a </p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="n">ddf16</span><span class="p">[</span><span class="s1">&#39;host_response_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="n">ddf16</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf16</span><span class="p">[</span><span class="s1">&#39;host_response_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s1">&#39;host_response_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span>
<span class="normal"><a href="#__codelineno-122-2">2</a></span>
<span class="normal"><a href="#__codelineno-122-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="n">response_mask</span> <span class="o">=</span> <span class="n">ddf16</span><span class="p">[</span><span class="s1">&#39;host_response_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="n">host_response_rate</span> <span class="o">=</span> <span class="n">ddf16</span><span class="p">[</span><span class="s1">&#39;host_response_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">response_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="n">ddf17</span> <span class="o">=</span> <span class="n">ddf16</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;host_response_rate&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">host_response_rate</span><span class="o">=</span><span class="n">host_response_rate</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's fix the cleaning fee now</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="n">cl_fee</span> <span class="o">=</span> <span class="n">ddf17</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="n">cl_fee</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1">1</a></span>
<span class="normal"><a href="#__codelineno-124-2">2</a></span>
<span class="normal"><a href="#__codelineno-124-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2"></a>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3"></a><span class="n">ddf17</span><span class="p">[</span><span class="s1">&#39;property_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1">1</a></span>
<span class="normal"><a href="#__codelineno-125-2">2</a></span>
<span class="normal"><a href="#__codelineno-125-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2"></a>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="n">ddf17</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;room_type&#39;</span><span class="p">])[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="c1"># ddf16.groupby([&#39;country&#39;, &#39;room_type&#39;])[&#39;cleaning_fee&#39;]</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="n">ddf17</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-127-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-127-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-127-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-127-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-127-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-127-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-127-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-127-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-127-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2"></a>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3"></a><span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Belgium&#39;</span><span class="p">,</span> <span class="s1">&#39;South Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4"></a><span class="n">currencies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;ZAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JPY&#39;</span><span class="p">]</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5"></a><span class="n">room_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Entire home/apt&#39;</span><span class="p">,</span> <span class="s1">&#39;Hotel room&#39;</span><span class="p">,</span> <span class="s1">&#39;Private room&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared room&#39;</span><span class="p">]</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6"></a>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7"></a><span class="k">for</span> <span class="n">ctry</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8"></a>    <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">room_type</span><span class="p">:</span>
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9"></a>        <span class="n">condition</span> <span class="o">=</span> <span class="p">((</span><span class="n">ddf17</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ctry</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf17</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">room</span><span class="p">))</span>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For </span><span class="si">{</span><span class="n">ctry</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> we have a median of </span><span class="si">{</span><span class="n">ddf17</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>We are going to assume that a basket of goods in Japan, Belgium, and South Africa won't differ significantly --although this might be very skewed-- and first convert the prices and their different denominations into 'USD', and then compare the median and average cleaning fee per room type.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="n">c</span> <span class="o">=</span> <span class="n">CurrencyConverter</span><span class="p">(</span><span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span>
<span class="normal"><a href="#__codelineno-129-2">2</a></span>
<span class="normal"><a href="#__codelineno-129-3">3</a></span>
<span class="normal"><a href="#__codelineno-129-4">4</a></span>
<span class="normal"><a href="#__codelineno-129-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="n">first_US</span><span class="p">,</span> <span class="n">last_US</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;USD&#39;</span><span class="p">]</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2"></a><span class="n">first_BG</span><span class="p">,</span> <span class="n">last_BG</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">]</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3"></a><span class="n">first_SA</span><span class="p">,</span> <span class="n">last_SA</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;ZAR&#39;</span><span class="p">]</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4"></a><span class="n">first_JP</span><span class="p">,</span> <span class="n">last_JP</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;JPY&#39;</span><span class="p">]</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5"></a><span class="n">last_US</span><span class="p">,</span> <span class="n">last_BG</span><span class="p">,</span> <span class="n">last_SA</span><span class="p">,</span> <span class="n">last_JP</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1">1</a></span>
<span class="normal"><a href="#__codelineno-130-2">2</a></span>
<span class="normal"><a href="#__codelineno-130-3">3</a></span>
<span class="normal"><a href="#__codelineno-130-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="n">eur_to_usd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="n">zar_to_usd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ZAR&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="n">jpy_to_usd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;JPY&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="n">eur_to_usd</span><span class="p">,</span> <span class="n">zar_to_usd</span><span class="p">,</span> <span class="n">jpy_to_usd</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span>
<span class="normal"><a href="#__codelineno-131-2">2</a></span>
<span class="normal"><a href="#__codelineno-131-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2"></a>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3"></a><span class="n">currency_changes</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Changes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;curr_from&#39;</span><span class="p">,</span> <span class="s1">&#39;curr_to&#39;</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1">1</a></span>
<span class="normal"><a href="#__codelineno-132-2">2</a></span>
<span class="normal"><a href="#__codelineno-132-3">3</a></span>
<span class="normal"><a href="#__codelineno-132-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Belgium&#39;</span><span class="p">,</span> <span class="s1">&#39;South Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2"></a><span class="n">currencies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;ZAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JPY&#39;</span><span class="p">]</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="n">rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">eur_to_usd</span><span class="p">,</span> <span class="n">zar_to_usd</span><span class="p">,</span> <span class="n">jpy_to_usd</span><span class="p">]</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">,</span> <span class="s1">&#39;extra_people&#39;</span><span class="p">,</span> <span class="s1">&#39;security_deposit&#39;</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-133-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-133-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-133-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-133-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-133-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-133-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-133-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-133-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-133-10">10</a></span>
<span class="normal"><a href="#__codelineno-133-11">11</a></span>
<span class="normal"><a href="#__codelineno-133-12">12</a></span>
<span class="normal"><a href="#__codelineno-133-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2"></a>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3"></a><span class="k">def</span> <span class="nf">change_currency</span><span class="p">(</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">currency_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">country_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">countries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">denominations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6"></a>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">currency_cols</span><span class="p">:</span>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8"></a>        <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">curr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">denominations</span><span class="p">):</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9"></a>            <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">country_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">country</span><span class="p">)</span>
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10"></a>            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*</span> <span class="n">curr</span><span class="p">)</span> <span class="c1">#.apply(lambda x: round(c.convert(x, curr, target_currency), 2) if x != np.nan else np.nan)</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11"></a><span class="c1">#             data.loc[condition, col] = new_data_currencies</span>
</span><span id="__span-133-12"><a id="__codelineno-133-12" name="__codelineno-133-12"></a>
</span><span id="__span-133-13"><a id="__codelineno-133-13" name="__codelineno-133-13"></a>    <span class="k">return</span> <span class="n">data</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1">1</a></span>
<span class="normal"><a href="#__codelineno-134-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="n">ddf18</span> <span class="o">=</span> <span class="n">ddf17</span><span class="o">.</span><span class="n">map_partitions</span><span class="p">(</span><span class="n">change_currency</span><span class="p">,</span> <span class="n">currency_cols</span><span class="o">=</span><span class="n">target_cols</span><span class="p">,</span> <span class="n">country_col</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">countries</span><span class="o">=</span><span class="n">countries</span><span class="p">,</span> <span class="n">denominations</span><span class="o">=</span><span class="n">rates</span><span class="p">)</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2"></a><span class="n">ddf18</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="n">ddf17</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1">1</a></span>
<span class="normal"><a href="#__codelineno-136-2">2</a></span>
<span class="normal"><a href="#__codelineno-136-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2"></a>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3"></a><span class="p">(</span><span class="n">ddf18</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddf18</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1">1</a></span>
<span class="normal"><a href="#__codelineno-137-2">2</a></span>
<span class="normal"><a href="#__codelineno-137-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2"></a>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3"></a><span class="n">ddf18</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;room_type&#39;</span><span class="p">])[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1">1</a></span>
<span class="normal"><a href="#__codelineno-138-2">2</a></span>
<span class="normal"><a href="#__codelineno-138-3">3</a></span>
<span class="normal"><a href="#__codelineno-138-4">4</a></span>
<span class="normal"><a href="#__codelineno-138-5">5</a></span>
<span class="normal"><a href="#__codelineno-138-6">6</a></span>
<span class="normal"><a href="#__codelineno-138-7">7</a></span>
<span class="normal"><a href="#__codelineno-138-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2"></a>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3"></a><span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Belgium&#39;</span><span class="p">,</span> <span class="s1">&#39;South Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4"></a><span class="n">room_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Entire home/apt&#39;</span><span class="p">,</span> <span class="s1">&#39;Hotel room&#39;</span><span class="p">,</span> <span class="s1">&#39;Private room&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared room&#39;</span><span class="p">]</span>
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5"></a>
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6"></a><span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">room_type</span><span class="p">:</span>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7"></a>    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">room</span><span class="p">)</span>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> we have a median of </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">ddf18</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1">1</a></span>
<span class="normal"><a href="#__codelineno-139-2">2</a></span>
<span class="normal"><a href="#__codelineno-139-3">3</a></span>
<span class="normal"><a href="#__codelineno-139-4">4</a></span>
<span class="normal"><a href="#__codelineno-139-5">5</a></span>
<span class="normal"><a href="#__codelineno-139-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2"></a>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="n">entire_home</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Entire home/apt&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4"></a><span class="n">hotel_room</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hotel room&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5"></a><span class="n">private_room</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Private room&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6"></a><span class="n">shared_room</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Shared room&#39;</span><span class="p">,</span> <span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1"></a><span class="n">ddf18</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-142-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-142-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-142-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-142-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-142-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-142-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-142-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-142-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-142-10">10</a></span>
<span class="normal"><a href="#__codelineno-142-11">11</a></span>
<span class="normal"><a href="#__codelineno-142-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="n">condition_eh</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Entire home/apt&#39;</span><span class="p">)</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="n">condition_hr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hotel room&#39;</span><span class="p">)</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="n">condition_pr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Private room&#39;</span><span class="p">)</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4"></a><span class="n">condition_sh</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Shared room&#39;</span><span class="p">)</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5"></a>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6"></a><span class="n">cleaning_fee</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_eh</span><span class="p">,</span> <span class="n">entire_home</span><span class="p">)</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7"></a>                                     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_hr</span><span class="p">,</span> <span class="n">hotel_room</span><span class="p">)</span>
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8"></a>                                     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_pr</span><span class="p">,</span> <span class="n">private_room</span><span class="p">)</span>
</span><span id="__span-142-9"><a id="__codelineno-142-9" name="__codelineno-142-9"></a>                                     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_sh</span><span class="p">,</span> <span class="n">shared_room</span><span class="p">))</span>
</span><span id="__span-142-10"><a id="__codelineno-142-10" name="__codelineno-142-10"></a>
</span><span id="__span-142-11"><a id="__codelineno-142-11" name="__codelineno-142-11"></a><span class="n">ddf19</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cleaning_fee</span><span class="o">=</span><span class="n">cleaning_fee</span><span class="p">)</span>
</span><span id="__span-142-12"><a id="__codelineno-142-12" name="__codelineno-142-12"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>The code above is equivalent to creating a chain of lazy variables that build the operation we want one step at a time. Here is an example of another implementation.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1">1</a></span>
<span class="normal"><a href="#__codelineno-143-2">2</a></span>
<span class="normal"><a href="#__codelineno-143-3">3</a></span>
<span class="normal"><a href="#__codelineno-143-4">4</a></span>
<span class="normal"><a href="#__codelineno-143-5">5</a></span>
<span class="normal"><a href="#__codelineno-143-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1"></a><span class="n">cleaning_fee1</span> <span class="o">=</span> <span class="n">ddf18</span><span class="p">[</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_eh</span><span class="p">,</span> <span class="n">entire_home</span><span class="p">)</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2"></a><span class="n">cleaning_fee2</span> <span class="o">=</span> <span class="n">cleaning_fee1</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_hr</span><span class="p">,</span> <span class="n">hotel_room</span><span class="p">)</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3"></a><span class="n">cleaning_fee3</span> <span class="o">=</span> <span class="n">cleaning_fee2</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_pr</span><span class="p">,</span> <span class="n">private_room</span><span class="p">)</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4"></a><span class="n">cleaning_fee4</span> <span class="o">=</span> <span class="n">cleaning_fee3</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">condition_sh</span><span class="p">,</span> <span class="n">shared_room</span><span class="p">)</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5"></a>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6"></a><span class="n">ddf19</span> <span class="o">=</span> <span class="n">ddf18</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;cleaning_fee&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cleaning_fee</span><span class="o">=</span><span class="n">cleaning_fee</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1">1</a></span>
<span class="normal"><a href="#__codelineno-144-2">2</a></span>
<span class="normal"><a href="#__codelineno-144-3">3</a></span>
<span class="normal"><a href="#__codelineno-144-4">4</a></span>
<span class="normal"><a href="#__codelineno-144-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="o">%%</span><span class="n">time</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2"></a>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3"></a><span class="n">missing_values</span> <span class="o">=</span> <span class="n">ddf19</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4"></a><span class="n">whats_left_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">missing_values</span> <span class="o">/</span> <span class="n">ddf19</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5"></a><span class="n">whats_left_pct</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;our_cleaning_process2.svg&#39;</span><span class="p">,</span> <span class="n">optimize_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">npartitions</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">dtypes</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span>
<span class="normal"><a href="#__codelineno-149-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1"></a><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">():</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2"></a>    <span class="n">ddf20</span> <span class="o">=</span> <span class="n">ddf19</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>Let's reacap what we have done now that we have a nicely clean dataset</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="n">cleaned_files</span> <span class="o">=</span> <span class="n">check_or_add</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;clean_files&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>Get the datatypes and save them.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="n">ddf19</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="n">npartitions</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">cleaned_files</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;snappy&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><img alt="ManipulateData" src="../../images/13.png" /></p>
<p>Let's go over, and create, some of the columns that could be useful for our analysis</p>
<p>Final price per stay</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1"></a>
</span></code></pre></div></td></tr></table></div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1"></a>
</span></code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Ramon Perez
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/ramonpzg/rpg_content" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:ramonpzg01@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "content.tabs.link", "toc.follow", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>